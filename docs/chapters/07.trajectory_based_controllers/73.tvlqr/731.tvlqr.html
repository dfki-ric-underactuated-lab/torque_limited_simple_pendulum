<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Theory &mdash; Torque-limited Simple Pendulum 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Region of Attraction (RoA) estimation" href="732.tvlqr_roa.html" />
    <link rel="prev" title="Time-varying Linear Quadratic Regulator (TVLQR)" href="../73.tvlqr.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Torque-limited Simple Pendulum
            <img src="../../../_static/logo.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00.installation_guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01.usage_instructions.html">Usage Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02.code_testing.html">How to test the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03.model.html">The Physics of a Simple Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04.hardware.html">Hardware Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05.trajectory_optimization.html">Trajectory Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06.reinforcement_learning.html">Reinforcement Learning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../07.trajectory_based_controllers.html">Trajectory-based Controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../71.open_loop.html">Open Loop Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../72.pid.html">Proportional-Integral-Derivative (PID) Control</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../73.tvlqr.html">Time-varying Linear Quadratic Regulator (TVLQR)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="732.tvlqr_roa.html">Region of Attraction (RoA) estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../74.ilqr.html">iLQR Model Predictive Control</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../08.policy_based_controllers.html">Policy-based Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09.analysis.html">Controller Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10.simulation.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11.contributing.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simple_pendulum.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Torque-limited Simple Pendulum</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../07.trajectory_based_controllers.html">Trajectory-based Controllers</a> &raquo;</li>
          <li><a href="../73.tvlqr.html">Time-varying Linear Quadratic Regulator (TVLQR)</a> &raquo;</li>
      <li>Theory</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/chapters/07.trajectory_based_controllers/73.tvlqr/731.tvlqr.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Type: Closed loop control</p>
<p>State/action space contraints: -</p>
<p>Optimal: -</p>
<p>Versatility: -</p>
</div>
<section id="theory">
<h1>Theory<a class="headerlink" href="#theory" title="Permalink to this heading"></a></h1>
<p>This controller is designed to follow a precomputed trajectory from of a csv file to the simulator or the real pendulum.
Particulary, the controller can process trajectories that have been found with help of the <a class="reference external" href="https://github.com/dfki-ric-underactuated-lab/torque_limited_simple_pendulum/tree/master/software/python/simple_pendulum/trajectory_optimization">trajectory optimization</a> methods.</p>
<p>The Time-varying Linear Quadratic Regulator (TVLQR) is an extension to the regular <a class="reference external" href="https://github.com/dfki-ric-underactuated-lab/torque_limited_simple_pendulum/tree/master/software/python/simple_pendulum/controllers/lqr">LQR controller</a>. The LQR formalization is used for a time-varying linear dynamics function</p>
<div class="math">
<p><img src="../../../_images/math/e1ae04d5ce0615dc6763c37171fe01b9b892a02f.svg" alt="\dot{\mathbf{x}} =  \mathbf{A}(t)\mathbf{x} \mathbf{B}(t)\mathbf{u}"/></p>
</div><p>The TVLQR controller tries to stabilize the system along a nominal trajectory. For this, at every timestep the system dynamics are linearized around the state of the nominal trajectory <img class="math" src="../../../_images/math/96be25adf4e29c90ff7c3018ec8b5d38acd076ec.svg" alt="\mathbf{x}_0(t), \mathbf{u}_0(t)"/> at the given timestep <cite>t</cite>. The LQR formalism then can be used to derive the optimal controller at timestep <cite>t</cite>:</p>
<div class="math">
<p><img src="../../../_images/math/172e140307fac541b6934a85ae8840fbd3371f62.svg" alt="u(\mathbf{x}) = \mathbf{u}_0(t) - \mathbf{K}(t) \left( \mathbf{x} - \mathbf{x}_0(t)\right)"/></p>
</div><p>For further reading, we recommend chapter 8 of this <a class="reference external" href="http://underactuated.mit.edu/">Underactuated Robotics [1]</a> lecture.</p>
</section>
<section id="api">
<h1>API<a class="headerlink" href="#api" title="Permalink to this heading"></a></h1>
<p>The controller needs pendulum parameters as input during initialization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TVLQRController</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">damping</span><span class="p">,</span> <span class="n">gravity</span><span class="p">,</span> <span class="n">torque_limit</span><span class="p">)</span>
    <span class="n">inputs</span><span class="p">:</span>
        <span class="n">data_dict</span><span class="p">:</span> <span class="n">dictionary</span>
            <span class="n">A</span> <span class="n">dictionary</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">below</span> <span class="n">specified</span> <span class="nb">format</span>
        <span class="n">mass</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="mf">0.5</span>
        <span class="n">damping</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="mf">0.1</span>
        <span class="n">gravity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="mf">9.81</span>
        <span class="n">torque_limit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</pre></div>
</div>
<p>The data_dict dictionary should have the entries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;des_time_list&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="n">desired</span> <span class="n">timesteps</span>
<span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;des_pos_list&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="n">desired</span> <span class="n">positions</span>
<span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;des_vel_list&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="n">desired</span> <span class="n">velocities</span>
<span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;des_tau_list&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="n">desired</span> <span class="n">torques</span>
</pre></div>
</div>
<p>The values are assumed to be in SI units, i.e. time in s, position in rad, velocity in rad/s, torque in Nm.</p>
<p>The control output <img class="math" src="../../../_images/math/c060527a11ec7497d93173e49380f661196c94e1.svg" alt="\mathbf{u}(\mathbf{x})"/> can be obtained with the API of the abstract controller class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TVLQRController</span><span class="o">.</span><span class="n">get_control_output</span><span class="p">(</span><span class="n">mean_pos</span><span class="p">,</span> <span class="n">mean_vel</span><span class="p">,</span> <span class="n">meas_tau</span><span class="p">,</span> <span class="n">meas_time</span><span class="p">)</span>
    <span class="n">inputs</span><span class="p">:</span>
        <span class="n">meas_pos</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pendulum</span>
        <span class="n">meas_vel</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pendulum</span>
        <span class="n">meas_tau</span><span class="p">:</span> <span class="ow">not</span> <span class="n">used</span>
        <span class="n">meas_time</span><span class="p">:</span> <span class="ow">not</span> <span class="n">used</span>
    <span class="n">returns</span><span class="p">:</span>
        <span class="n">des_pos</span><span class="p">,</span> <span class="n">des_vel</span><span class="p">,</span> <span class="n">u</span>
</pre></div>
</div>
<p>The function returns the desired position, desired velocity as specified in the csv file at the given index. The returned torque is processed by the TVLQR controller as described in the theory section.</p>
<p>The index counter is incremeted by 1 every time the get_control_output function is called.</p>
</section>
<section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h1>
<p>Before using this controller, first a trajectory has to be defined/calculated and stored to csv file or dictionary in a suitable format.</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h1>
<p>The trajectory optimization using direct collocation for the pendulum swing-up is accomplished by taking advantage of <a class="reference external" href="https://drake.mit.edu/">Drake toolbox [2]</a>.</p>
</section>
<section id="comments">
<h1>Comments<a class="headerlink" href="#comments" title="Permalink to this heading"></a></h1>
<p>The controller will not scale the trajectory according to the time values in the csv file. All it does is process the rows of the file one by one with each call of get_control_output.</p>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="http://underactuated.mit.edu/">[1] Russ Tedrake. Underactuated Robotics: Algorithms for Walking, Running, Swimming, Flying, and Manipulation (Course Notes for MIT 6.832).</a></p>
<p><a class="reference external" href="https://drake.mit.edu/">[2] Model-Based Design and Verification for Robotics</a>.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../73.tvlqr.html" class="btn btn-neutral float-left" title="Time-varying Linear Quadratic Regulator (TVLQR)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="732.tvlqr_roa.html" class="btn btn-neutral float-right" title="Region of Attraction (RoA) estimation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Felix Wiebe, Jonathan Babel, Shivesh Kumar, Shubham Vyas, Daniel Harnack, Melya Boukheddimi, Mihaela Popescu, Frank Kirchner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>